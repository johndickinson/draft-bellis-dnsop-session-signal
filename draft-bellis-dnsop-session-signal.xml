<?xml version="1.0" encoding="us-ascii"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.0.30 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC6891 SYSTEM "http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6891.xml">
<!ENTITY RFC2119 SYSTEM "http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC1035 SYSTEM "http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.1035.xml">
<!ENTITY RFC0768 SYSTEM "http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.0768.xml">
<!ENTITY RFC7828 SYSTEM "http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7828.xml">
]>

<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>

<rfc ipr="trust200902" docName="draft-bellis-dnsop-session-signal-00" category="std">

  <front>
    <title>DNS Session Signaling</title>

    <author initials="R." surname="Bellis" fullname="Ray Bellis">
      <organization abbrev="ISC">Internet Systems Consortium, Inc.</organization>
      <address>
        <postal>
          <street>950 Charter Street</street>
          <city>Redwood City</city>
          <code>CA 94063</code>
          <country>USA</country>
        </postal>
        <phone>+1 650 423 1200</phone>
        <email>ray@isc.org</email>
      </address>
    </author>
    <author initials="S." surname="Cheshire" fullname="Stuart Cheshire">
      <organization>Apple Inc.</organization>
      <address>
        <postal>
          <street>1 Infinite Loop</street>
          <city>Cupertino</city>
          <code>CA 95014</code>
          <country>USA</country>
        </postal>
        <phone>+1 408 974 3207</phone>
        <email>cheshire@apple.com</email>
      </address>
    </author>
    <author initials="S." surname="Dickinson" fullname="Sara Dickinson">
      <organization abbrev="Sinodun">Sinodun Internet Technologies</organization>
      <address>
        <postal>
          <street>Magadalen Centre</street> <street>Oxford Science Park</street>
          <city>Oxford</city>
          <code>OX4 4GA</code>
          <country>United Kingdom</country>
        </postal>
      </address>
    </author>
    <author initials="A." surname="Mankin" fullname="Allison Mankin">
      <organization>Unaffiliated</organization>
      <address>
        <email>allison.mankin@gmail.com</email>
      </address>
    </author>
    <author initials="T." surname="Pusateri" fullname="Tom Pusateri">
      <organization>Unaffiliated</organization>
      <address>
        <phone>+1 843 473 7394</phone>
        <email>pusateri@bangj.com</email>
      </address>
    </author>

    <date year="2016" month="April"/>

    <area>Internet</area>
    <workgroup>DNSOP Working Group</workgroup>
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>The Extension Mechanisms for DNS (EDNS(0)) <xref target="RFC6891"/> is explicitly
defined to only have &ldquo;per-message&rdquo; semantics.  This document defines a
new OpCode used to carry persistent &ldquo;per-session&rdquo; TLVs, and defines an
initial set of TLVs used to handle feature negotiation and to manage
session timeouts and termination.</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>&hellip;</t>

</section>
<section anchor="terminology" title="Terminology">

<t>The terms &ldquo;initiator&rdquo; and &ldquo;responder&rdquo; correspond respectively to the
initial sender and subsequent receiver of a Session TLV, regardless of
which was the &ldquo;client&rdquo; and &ldquo;server&rdquo; in the usual DNS sense.  The term
&ldquo;sender&rdquo; may apply to either an initiator or responder.</t>

<t>The key words &ldquo;MUST&rdquo;, &ldquo;MUST NOT&rdquo;, &ldquo;REQUIRED&rdquo;, &ldquo;SHALL&rdquo;, &ldquo;SHALL NOT&rdquo;,
&ldquo;SHOULD&rdquo;, &ldquo;SHOULD NOT&rdquo;, &ldquo;RECOMMENDED&rdquo;, &ldquo;MAY&rdquo;, and &ldquo;OPTIONAL&rdquo; in this
document are to be interpreted as described in <xref target="RFC2119"/>.</t>

</section>
<section anchor="protocol-details" title="Protocol Details">

<t>A packet containing the Session OpCode MUST NOT be sent over a
connectionless protocol such as UDP <xref target="RFC0768"/>.</t>

<t>Session TLVs relate only to the specific Layer 4 protocol connection
over which they are being carried.  In the presence of a middle box
(e.g. a DNS proxy or forwarder) they MUST NOT by forwarded in either
direction by that middle box.</t>

<section anchor="packet-format" title="Packet Format">

<t>A Session Signaling packet does not conform to the usual DNS packet
format.  The 12 octet header format from <xref target="RFC1035"/> is preserved, but
the four count fields (QDOUNT, ANCOUNT, NSCOUNT and ARCOUNT) MUST all be
set to zero.</t>

<t>A list of TLVs are used in place of the usual sections, and MUST appear
immediately after the 12 octet header.  The total size of the TLVs is
calculated from the value of the standard two octet framing word minus
the 12 octets of the DNS header.</t>

</section>
<section anchor="packet-handling" title="Packet Handling">

</section>
<section anchor="tlv-format" title="TLV Format">

<figure><artwork><![CDATA[
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
0: |  SESS-STATUS  |         SESSION-TYPE                          |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
2: |                        SESSION-LENGTH                         |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
4: |                                                               |
   /                         SESSION-DATA                          /
   /                                                               /
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
]]></artwork></figure>

<t><list style="hanging">
  <t hangText='SESS-STATUS:'>
  A 4 bit field used to differentiate between requests and
responses (and the success or otherwise of the latter), per the DNS
Session Status Codes Registry.  It MUST contain &ldquo;REQUEST&rdquo; (0) within
request packets and a non-zero code in response packets.</t>
  <t hangText='SESSION-TYPE:'>
  A 12 bit field in network order giving the type of the
current Session TLV per the IANA DNS Session Type Codes Registry.</t>
  <t hangText='SESSION-LENGTH:'>
  A 16 bit field in network order giving the size in octets of
SESSION-DATA.</t>
  <t hangText='SESSION-DATA:'>
  Type-code specific.  The SESSION-DATA field MUST be NUL padded to an
even number of octets such that each Session TLV is aligned on a two
octet boundary relative to the start of the first Session TLV.  Padding
octets MUST NOT be included in the calculation of SESSION-LENGTH but
MUST be included in the calculation of the overall message length.</t>
</list></t>

</section>
</section>
<section anchor="mandatory-tlvs" title="Mandatory TLVs">

<section anchor="feature-negotiation" title="Feature Negotiation">

<section anchor="session-support" title="Session Support">

<t>The Session Support TLV (1) is used to allow an client and server
to exchange information about which Session Type Codes they support.</t>

<t>The SESSION-DATA contains a list of the Session Type Codes supported by
the sender.</t>

<figure><artwork><![CDATA[
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |                           TYPE CODEs                          |
   /                              ...                              /
   /                                                               /
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
]]></artwork></figure>

<t><list style="hanging">
  <t hangText='TYPE CODEs:'>
  A list of 16 bit words in network order comprising the complete list
of Session Type Codes supported by the sender.  Since a Session Type
Code is in reality only a 12 bit value, the four most significant bits
of each word MUST be zero.  The number of TYPE CODEs can be calculated
from the total length of the TLV.</t>
</list></t>

<t>An initiator MAY send its own list of supported Session Type Codes in a
Session Support TLV, and if sent they MUST be complete.  Otherwise the
SESSION-DATA MUST be empty.</t>

</section>
<section anchor="edns-support" title="EDNS Support">

<t>The EDNS Support TLV (2) is used to allow a client and server to
exchange information about which EDNS Version, Flags and Option Codes
they support.</t>

<t>The SESSION-DATA contains the supported EDNS version number and EDNS
flags followed by a list of of the EDNS Option Codes supported by the
sender.</t>

<figure><artwork><![CDATA[
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |               Z               |            VERSION            |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |                             FLAGS                             |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |                           OPT CODEs                           |
   /                              ...                              /
   /                                                               /
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
]]></artwork></figure>

<t><list style="hanging">
  <t hangText='Z:'>
  Set to zero by initiators and ignored by responders, unless modified
in a subsequent specification.</t>
  <t hangText='VERSION:'>
  The maximum EDNS version number supported by the sender.</t>
  <t hangText='FLAGS:'>
  A bit mask containing a one (1) for each corresponding EDNS Flag bit
(e.g. &ldquo;DO&rdquo;) supported by the sender, and zero (0) otherwise.</t>
  <t hangText='OPT CODEs:'>
  A list of 16 bit words in network order containing the complete list
of EDNS Option Codes supported by the sender.  The number of OPT CODEs
can be calculated from the total length of the TLV minus the four octets
for the preceding fields.</t>
</list></t>

<t>A client MAY send its own EDNS Support data in an EDNS Support TLV,
and if sent it MUST be complete.  Otherwise the SESSION-DATA MUST be
empty.</t>

<t>A server SHOULD NOT sent an unsoliticited populated EDNS Support TLV.</t>

</section>
</section>
<section anchor="layer-4-connection-management-tlvs" title="Layer 4 Connection Management TLVs">

<section anchor="terminate" title="Terminate">

<t>The Terminate TLV (64) MAY be sent be a server to request that the client
terminate the connection.  It MUST NOT be sent by a client.</t>

<t>The client SHOULD terminate the connection as soon as possible, but MAY
wait for any inflight queries to be answered.  It SHOULD NOT initiate
any new queries over the existing connection.</t>

<t>This TLV has no SESSION-DATA.</t>

</section>
<section anchor="idle-timeout" title="Idle Timeout">

<t>The Idle Timeout TLV (65) has similar semantics to the EDNS TCP
Keepalive Option <xref target="RFC7828"/>.  It is used by a server to tell the
client how long it may leave the current connection idle for.</t>

<t>The SESSION-DATA is as follows:</t>

<figure><artwork><![CDATA[
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |                         IDLE TIMEOUT                          |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
]]></artwork></figure>

<t><list style="hanging">
  <t hangText='IDLE TIMEOUT:'>
  the idle timeout for the current Layer 4 connection, specified as a 16
bit word in network order in units of 100 milliseconds.</t>
</list></t>

<t>It is NOT an error for this TLV and the similar EDNS option to appear
within the same connection.  The client SHOULD pay attention to the most
recently received value, regardless of which method was used to send it.</t>

<t>(author&rsquo;s note - this assumes that the EDNS OPT RR is added at the final
stage of packet processing, and therefore not affected by out-of-order
processing).</t>

</section>
</section>
</section>
<section anchor="iana-considerations" title="IANA Considerations">

<section anchor="dns-session-opcode-registration" title="DNS Session OpCode Registration">

<t>IANA are directed to assign the value TBD for the Session OpCode in the
DNS OpCodes Registry.</t>

</section>
<section anchor="dns-session-status-codes-registry" title="DNS Session Status Codes Registry">

<t>IANA are directed to create the DNS Session Status Codes Registry, with
initial values as follows:</t>

<texttable>
      <ttcol align='right'>Code</ttcol>
      <ttcol align='left'>Mnemonic</ttcol>
      <ttcol align='left'>Description</ttcol>
      <ttcol align='left'>Reference</ttcol>
      <c>0</c>
      <c>REQUEST</c>
      <c>Request packet</c>
      <c>RFC-TBD1</c>
      <c>4</c>
      <c>NOTIMP</c>
      <c>TLV not implemented</c>
      <c>RFC-TBD1</c>
      <c>5</c>
      <c>REFUSED</c>
      <c>TLV declined for policy reasons</c>
      <c>RFC-TBD1</c>
      <c>15</c>
      <c>SUCCESS</c>
      <c>TLV processed sucessfully</c>
      <c>RFC-TBD1</c>
</texttable>

<t>Registration of additional Session Status Codes requires Standards Action.</t>

</section>
<section anchor="dns-session-type-codes-registry" title="DNS Session Type Codes Registry">

<t>IANA are directed to create the DNS Session Type Codes Registry, with
initial values as follows:</t>

<texttable>
      <ttcol align='right'>Type</ttcol>
      <ttcol align='left'>Name</ttcol>
      <ttcol align='left'>Status</ttcol>
      <ttcol align='left'>Reference</ttcol>
      <c>0</c>
      <c>Reserved</c>
      <c>&#160;</c>
      <c>RFC-TBD1</c>
      <c>1</c>
      <c>Session Support</c>
      <c>Standard</c>
      <c>RFC-TBD1</c>
      <c>2</c>
      <c>EDNS Support</c>
      <c>Standard</c>
      <c>RFC-TBD1</c>
      <c>3 - 63</c>
      <c>Unassigned, reserved for feature negotiation TLVs</c>
      <c>&#160;</c>
      <c>&#160;</c>
      <c>64</c>
      <c>Terminate</c>
      <c>Standard</c>
      <c>RFC-TBD1</c>
      <c>65</c>
      <c>Idle Timeout</c>
      <c>Standard</c>
      <c>RFC-TBD1</c>
      <c>66 - 127</c>
      <c>Unassigned, reserved for layer 4 connection TLVs</c>
      <c>&#160;</c>
      <c>&#160;</c>
      <c>127 - 3965</c>
      <c>Unassigned</c>
      <c>&#160;</c>
      <c>&#160;</c>
      <c>3968 - 4031</c>
      <c>Reserved for local / experimental use</c>
      <c>&#160;</c>
      <c>&#160;</c>
      <c>4032 - 4095</c>
      <c>Reserved for future expansion</c>
      <c>&#160;</c>
      <c>&#160;</c>
</texttable>

<t>Registration of additional Session Type Codes requires Expert Review.</t>

</section>
</section>
<section anchor="security-considerations" title="Security Considerations">

<t>TBD</t>

</section>
<section anchor="acknowledgements" title="Acknowledgements">

<t>TBW</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC6891;
&RFC2119;
&RFC1035;


    </references>

    <references title='Informative References'>

&RFC0768;
&RFC7828;


    </references>



  </back>
</rfc>

